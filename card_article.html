<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ù‚Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { cairo: ['Cairo','sans-serif'] },
          boxShadow: {
            glow: '0 0 0 1px rgba(255,255,255,.08), 0 20px 40px rgba(0,0,0,.15)'
          }
        }
      }
    }
  </script>

  <!-- Fonts & Base -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="global.css">
  <link rel="stylesheet" href="sidebar.css">

  <!-- CKEditor -->
  <script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/classic/ckeditor.js"></script>
</head>

<body class="font-cairo bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-900 dark:to-slate-800 transition-colors">

<!-- Sidebar -->
<div id="sidebar"></div>
<script src="sidebar.js"></script>

<!-- Header -->
<div class="ml-[260px] px-10 pt-10">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-slate-800 dark:text-white">
        Ù…Ù‚Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
      </h1>
      <p class="text-slate-500 dark:text-slate-400 mt-1">
        ØªØ­Ø±ÙŠØ± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
      </p>
    </div>
  </div>
</div>

<!-- Editor Container -->
<div class="ml-[260px] px-10 pb-24">
  <div class="backdrop-blur-xl bg-white/85 dark:bg-slate-800/70
              border border-white/30 dark:border-white/10
              rounded-3xl p-8 shadow">

    <!-- Card Info -->
    <div class="mb-6">
      <h2 id="cardTitle"
          class="text-2xl font-bold text-slate-800 dark:text-white mb-1">â€”</h2>
      <p id="cardDesc"
         class="text-slate-600 dark:text-slate-400">â€”</p>
    </div>

    <!-- Editor -->
    <div class="bg-white dark:bg-slate-900 rounded-2xl
                border border-slate-200 dark:border-slate-700
                overflow-hidden mb-6">
      <div id="editor" class="min-h-[280px]"></div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3">
      <button
        onclick="saveArticle()"
        class="px-6 py-3 rounded-2xl
               bg-gradient-to-r from-blue-500 to-indigo-600
               text-white font-semibold shadow
               hover:shadow-lg hover:-translate-y-0.5 transition">
        ğŸ’¾ Ø­ÙØ¸
      </button>

      <button
        onclick="deleteArticle()"
        class="px-6 py-3 rounded-2xl
               bg-gradient-to-r from-rose-500 to-red-600
               text-white font-semibold shadow
               hover:shadow-lg hover:-translate-y-0.5 transition">
        ğŸ—‘ Ø­Ø°Ù
      </button>
    </div>

  </div>
</div>

<!-- ================= Firebase + CKEditor Logic (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ================= -->
<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

const shelfId = localStorage.getItem("selectedShelfId");
const cardId  = localStorage.getItem("selectedCardId");

if (!shelfId || !cardId) {
  alert("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©");
  location.href = "shelves.html";
}

const ref = doc(db, "shelves", shelfId, "cards", cardId);
let editorInstance;

ClassicEditor.create(document.querySelector('#editor'))
.then(async editor => {
  editorInstance = editor;

  const snap = await getDoc(ref);
  if (snap.exists()) {
    document.getElementById("cardTitle").innerText = snap.data().title;
    document.getElementById("cardDesc").innerText  = snap.data().desc || "";
    editor.setData(snap.data().articleHtml || "");
  }
});

window.saveArticle = async () => {
  await updateDoc(ref, { articleHtml: editorInstance.getData() });
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù‚Ø§Ù„ âœ…");
};

window.deleteArticle = async () => {
  if (!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„ØŸ")) return;
  await updateDoc(ref, { articleHtml: "" });
  editorInstance.setData("");
};
</script>

</body>
</html>
