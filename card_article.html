<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مقال البطاقة</title>

  <link rel="stylesheet" href="global.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    body { background:#eef3f9; font-family:"Cairo",sans-serif; }
    .article-container {
      margin-left:260px; margin-top:100px;
      background:white; padding:30px;
      border-radius:20px; width:75%;
    }
    .actions { margin-top:15px; display:flex; gap:10px; }
    .save-btn { background:#4b6fff; color:white; padding:10px 22px; border-radius:12px; border:none; }
    .delete-btn { background:#ff4b4b; color:white; padding:10px 22px; border-radius:12px; border:none; }
  </style>

  <script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/classic/ckeditor.js"></script>
</head>

<body>

<div id="sidebar"></div>
<script src="sidebar.js"></script>

<div class="top-nav">
  <div class="nav-left"><h1>مقال البطاقة</h1></div>
</div>

<div class="article-container">
  <h2 id="cardTitle">—</h2>
  <p id="cardDesc" class="desc">—</p>

  <div id="editor"></div>

  <div class="actions">
    <button class="save-btn" onclick="saveArticle()">حفظ</button>
    <button class="delete-btn" onclick="deleteArticle()">حذف</button>
  </div>
</div>

<script>
  const shelfId = localStorage.getItem("selectedShelfId");
  const cardId  = localStorage.getItem("selectedCardId");

  if (!shelfId || !cardId) {
    alert("لم يتم تحديد البطاقة");
    location.href = "shelves.html";
  }

  let editorInstance;

  ClassicEditor.create(document.querySelector('#editor'))
    .then(editor => {
      editorInstance = editor;
      const saved = localStorage.getItem("card_article_" + cardId);
      if (saved) editor.setData(saved);
    });

  function saveArticle() {
    localStorage.setItem(
      "card_article_" + cardId,
      editorInstance.getData()
    );
    alert("تم حفظ المقال ✅");
  }

  function deleteArticle() {
    if (!confirm("حذف المقال؟")) return;
    localStorage.removeItem("card_article_" + cardId);
    editorInstance.setData("");
  }
</script>

</body>
</html>
