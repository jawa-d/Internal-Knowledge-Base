<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ­Ø±ÙŠØ± Ø§Ù„Ø®Ø¨Ø±</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { cairo: ['Cairo','sans-serif'] },
          boxShadow: {
            glow: '0 0 0 1px rgba(255,255,255,.08), 0 20px 40px rgba(0,0,0,.15)'
          }
        }
      }
    }
  </script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Global -->
  <link rel="stylesheet" href="global.css">
  <link rel="stylesheet" href="sidebar.css">

  <!-- CKEditor -->
  <script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/classic/ckeditor.js"></script>
</head>

<body class="font-cairo bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-900 dark:to-slate-800 transition-colors">

<!-- Sidebar -->
<div id="sidebar"></div>
<script src="sidebar.js"></script>

<!-- Header -->
<div class="ml-[260px] px-10 pt-10">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-slate-800 dark:text-white">
        ØªØ­Ø±ÙŠØ± Ø§Ù„Ø®Ø¨Ø±
      </h1>
      <p class="text-slate-500 dark:text-slate-400 mt-1">
        ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø± ÙˆÙ†Ø´Ø±Ù‡
      </p>
    </div>
  </div>
</div>

<!-- Editor Container -->
<div class="ml-[260px] px-10 pb-24">
  <div class="backdrop-blur-xl bg-white/85 dark:bg-slate-800/70
              border border-white/30 dark:border-white/10
              rounded-3xl p-8 shadow">

    <!-- News Info -->
    <div class="mb-6">
      <h2 id="newsTitle"
          class="text-2xl font-bold text-slate-800 dark:text-white mb-1">â€”</h2>
      <p id="newsDesc"
         class="text-slate-600 dark:text-slate-400">â€”</p>
    </div>

    <!-- Editor -->
    <div class="bg-white dark:bg-slate-900 rounded-2xl
                border border-slate-200 dark:border-slate-700
                overflow-hidden mb-6">
      <div id="editor" class="min-h-[300px]"></div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3">
      <button
        onclick="saveArticle()"
        class="px-6 py-3 rounded-2xl
               bg-gradient-to-r from-blue-500 to-indigo-600
               text-white font-semibold shadow
               hover:shadow-lg hover:-translate-y-0.5 transition">
        ğŸ’¾ Ø­ÙØ¸
      </button>

      <button
        onclick="deleteArticle()"
        class="px-6 py-3 rounded-2xl
               bg-gradient-to-r from-rose-500 to-red-600
               text-white font-semibold shadow
               hover:shadow-lg hover:-translate-y-0.5 transition">
        ğŸ—‘ Ø­Ø°Ù
      </button>
    </div>

  </div>
</div>

<!-- ================= Firebase + CKEditor Logic (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ================= -->
<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

const newsId = localStorage.getItem("selectedNewsId");

if (!newsId) {
  alert("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø¨Ø±");
  location.href = "news.html";
}

const ref = doc(db, "news", newsId);
let editorInstance;

ClassicEditor.create(document.querySelector("#editor"))
  .then(async editor => {
    editorInstance = editor;

    const snap = await getDoc(ref);
    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("newsTitle").innerText = data.title || "â€”";
      document.getElementById("newsDesc").innerText  = data.desc  || "â€”";
      editor.setData(data.content || "");
    }
  });

window.saveArticle = async () => {
  await updateDoc(ref, { content: editorInstance.getData() });
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®Ø¨Ø±");
};

window.deleteArticle = async () => {
  if (!confirm("Ø­Ø°Ù Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø±ØŸ")) return;
  await updateDoc(ref, { content: "" });
  editorInstance.setData("");
};
</script>

</body>
</html>
