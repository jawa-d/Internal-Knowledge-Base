<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>

  <!-- Tailwind CSS (Utility only â€“ no layout logic) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            cairo: ['Cairo', 'sans-serif'],
          },
          colors: {
            primary: '#0038a8',
            accent: '#00c2a8',
            danger: '#ef4444',
          }
        }
      }
    }
  </script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Core Styles -->
  <link rel="stylesheet" href="sidebar.css">
  <link rel="stylesheet" href="dashboard.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="font-cairo bg-slate-100 dark:bg-slate-900 min-h-screen transition-colors">

<!-- ================= Sidebar ================= -->
<div id="sidebar"></div>
<script src="sidebar.js"></script>

<!-- ================= Page Content ================= -->
<div class="page dashboard-page relative">

  <!-- ================= Header ================= -->
  <div class="dash-header flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold text-slate-800 dark:text-white">
        Dashboard
      </h1>
      <p class="text-slate-500 dark:text-slate-400 mt-1">
        Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…
      </p>
    </div>

    <!-- Logged User -->
    <div id="loggedUserBox" class="logged-user-box">
      <span id="loggedUserEmail" class="email">loading...</span>
    </div>

    <!-- Logout -->
    <button
      id="logoutBtn"
      class="px-4 py-2 rounded-xl bg-danger text-white shadow hover:opacity-90 transition"
    >
      ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    </button>
  </div>

  <!-- ================= KPI CARDS ================= -->
  <div class="cards mb-10">

    <div onclick="location.href='users.html'" class="card">
      <div class="icon">ğŸ‘¤</div>
      <div>
        <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
        <div class="number" id="usersCount">0</div>
      </div>
    </div>

    <div onclick="location.href='shelves.html'" class="card">
      <div class="icon">ğŸ—‚</div>
      <div>
        <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙÙˆÙ</div>
        <div class="number" id="shelvesCount">0</div>
      </div>
    </div>

    <div onclick="location.href='news.html'" class="card">
      <div class="icon">ğŸ“°</div>
      <div>
        <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</div>
        <div class="number" id="newsCount">0</div>
      </div>
    </div>

    <div onclick="location.href='kpi_productivity.html'" class="card">
      <div class="icon">ğŸ“Š</div>
      <div>
        <div class="label">Ù…Ø¤Ø´Ø±Ø§Øª KPI</div>
        <div class="number" id="kpiCount">0</div>
      </div>
    </div>

    <div onclick="location.href='exam.html'" class="card">
      <div class="icon">ğŸ“</div>
      <div>
        <div class="label">Ù…ÙˆØ¸ÙÙˆ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</div>
        <div class="number" id="examUsersCount">0</div>
      </div>
    </div>

  </div>

  <!-- ================= Charts Section ================= -->
  <div class="charts-wrapper">

    <!-- Row 1 : Big Charts -->
    <div class="charts-row charts-row--big">
      <div class="chart-card chart-card--big">
        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
        <canvas id="usersChart"></canvas>
      </div>

      <div class="chart-card chart-card--big">
        <h3>ØªØ·ÙˆØ± Ù…Ø¤Ø´Ø±Ø§Øª KPI</h3>
        <canvas id="kpiChart"></canvas>
      </div>
    </div>

    <!-- Row 2 : Small Charts -->
    <div class="charts-row charts-row--small">
      <div class="chart-card">
        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙÙˆÙ</h3>
        <canvas id="shelvesChart"></canvas>
      </div>

      <div class="chart-card">
        <h3>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØªØ¨</h3>
        <canvas id="booksChart"></canvas>
      </div>

      <div class="chart-card">
        <h3>Ù…ÙˆØ¸ÙÙˆ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ø´Ù‡Ø±ÙŠ)</h3>
        <canvas id="examUsersChart"></canvas>
      </div>
    </div>

  </div>

</div>

<!-- ================= Charts Logic (UNCHANGED) ================= -->
<script>
function createGradient(ctx, color) {
  const g = ctx.createLinearGradient(0, 0, 0, 240);
  g.addColorStop(0, color + '55');
  g.addColorStop(1, color + '00');
  return g;
}

const baseOptions = {
  responsive: true,
  maintainAspectRatio: false,
  tension: 0.45,
  plugins: { legend: { display: false } },
  scales: {
    x: { grid: { display: false } },
    y: { beginAtZero: true }
  }
};

function renderLineChart(id, data, color) {
  const el = document.getElementById(id);
  if (!el) return;
  const ctx = el.getContext("2d");

  new Chart(ctx, {
    type: "line",
    data: {
      labels: ["Jan","Feb","Mar","Apr","May","Jun"],
      datasets: [{
        data,
        borderColor: color,
        backgroundColor: createGradient(ctx, color),
        fill: true,
        pointRadius: 4
      }]
    },
    options: baseOptions
  });
}

function initDashboard() {
  updateCards(dashboardStats);

  renderLineChart("usersChart", buildTrend(dashboardStats.users), "#0038a8");
  renderLineChart("shelvesChart", buildTrend(dashboardStats.shelves), "#00c2a8");
  renderLineChart("booksChart", buildTrend(dashboardStats.shelves * 3), "#0038a8");
  renderLineChart("kpiChart", buildTrend(dashboardStats.kpi), "#00c2a8");
  renderLineChart("examUsersChart", buildTrend(dashboardStats.examUsers), "#0038a8");
}

initDashboard();


</script>

<!-- App Logic -->
<script type="module" src="dashboard.js"></script>
<script type="module">
  import { runAnnouncementPopup } from "./announcement_popup.js";
  runAnnouncementPopup();
</script>

</body>
</html>
